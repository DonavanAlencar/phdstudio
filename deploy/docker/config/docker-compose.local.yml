services:
  phdstudio:
    build:
      context: ${PROJECT_ROOT:-/root/phdstudio}
      dockerfile: deploy/docker/config/Dockerfile
    container_name: phdstudio-app-local
    ports:
      - "8080:80"
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/root/phdstudio}/env.dev
      - ${PROJECT_ROOT:-/root/phdstudio}/deploy/config/shared/.env
    environment:
      - NODE_ENV=development
      - VITE_API_URL=http://localhost:3001/api

  phd-api:
    build:
      context: ${PROJECT_ROOT:-/root/phdstudio}
      dockerfile: deploy/docker/config/api.Dockerfile
    container_name: phd-api-local
    ports:
      - "3001:3001"
    restart: unless-stopped
    env_file:
      - ${PROJECT_ROOT:-/root/phdstudio}/api/env.dev
      - ${PROJECT_ROOT:-/root/phdstudio}/deploy/config/shared/.env
    environment:
      - NODE_ENV=development
      - CRM_DB_HOST=phd-crm-db
      - PRODUCTS_MEDIA_BASE_URL=http://localhost:8080
      # Instagram Feed (valores vÃªm do env_file, mas explicitamente passados para garantir)
      - INSTAGRAM_ACCESS_TOKEN=${INSTAGRAM_ACCESS_TOKEN:-}
      - INSTAGRAM_USER_ID=${INSTAGRAM_USER_ID:-17841403453191047}
      - INSTAGRAM_API_VERSION=${INSTAGRAM_API_VERSION:-v22.0}
    depends_on:
      - phd-crm-db

  phd-crm-db:
    image: postgres:15-alpine
    container_name: phd-crm-db-local
    restart: always
    ports:
      - "5433:5432"
    environment:
      POSTGRES_DB: phd_crm
      POSTGRES_USER: phd_crm_user
      POSTGRES_PASSWORD: PhdCrm@2024!Strong#Pass
