services:
  phdstudio:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: phdstudio-app-local
    ports:
      - "8080:80"
    restart: unless-stopped
    env_file:
      - env.dev
    environment:
      - NODE_ENV=development
      - VITE_API_URL=http://localhost:3001/api

  phd-api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: phd-api-local
    ports:
      - "3001:3001"
    restart: unless-stopped
    env_file:
      - ./api/env.dev
    environment:
      - NODE_ENV=development
      - WP_DB_HOST=wp_db
      - CRM_DB_HOST=phd-crm-db
    depends_on:
      - wp_db
      - phd-crm-db

  wp_db:
    image: mysql:8.0
    container_name: wp_db_local
    command: --default-authentication-plugin=mysql_native_password
    restart: always
    ports:
      - "3307:3306"
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: wordpress_db
      MYSQL_USER: wp_user
      MYSQL_PASSWORD: WpUser@2024!Strong#Pass

  phd-crm-db:
    image: postgres:15-alpine
    container_name: phd-crm-db-local
    restart: always
    ports:
      - "5433:5432"
    environment:
      POSTGRES_DB: phd_crm
      POSTGRES_USER: phd_crm_user
      POSTGRES_PASSWORD: PhdCrm@2024!Strong#Pass
